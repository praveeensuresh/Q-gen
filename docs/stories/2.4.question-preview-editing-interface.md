# Story 2.4: Question Preview and Editing Interface

## Status
Draft

## Story
**As a** teacher,
**I want** to review and edit generated questions before exporting,
**so that** I can ensure quality and make adjustments as needed.

## Acceptance Criteria
1. Preview interface displays all generated questions in a clean, readable format
2. Teachers can edit question text, answer choices, and correct answers
3. Questions can be reordered or removed from the final set
4. Changes are saved and reflected in the export output
5. Preview shows the final template formatting
6. Interface is intuitive and requires no training

## Tasks / Subtasks
- [ ] Create question preview interface (AC: 1)
  - [ ] Design clean, readable question display
  - [ ] Add question type indicators
  - [ ] Implement responsive layout
- [ ] Implement inline editing functionality (AC: 2)
  - [ ] Add editable question text fields
  - [ ] Create answer choice editors
  - [ ] Add correct answer selection
- [ ] Add question reordering capabilities (AC: 3)
  - [ ] Implement drag-and-drop reordering
  - [ ] Add manual order adjustment
  - [ ] Update question numbering automatically
- [ ] Create question removal functionality (AC: 3)
  - [ ] Add delete question option
  - [ ] Implement confirmation dialogs
  - [ ] Update question counts and numbering
- [ ] Implement change tracking and saving (AC: 4)
  - [ ] Add auto-save functionality
  - [ ] Track changes and modifications
  - [ ] Save changes to database
- [ ] Add template preview integration (AC: 5)
  - [ ] Show final template formatting
  - [ ] Preview export appearance
  - [ ] Update preview on changes
- [ ] Design intuitive editing controls (AC: 6)
  - [ ] Create user-friendly interface
  - [ ] Add helpful tooltips and guidance
  - [ ] Implement keyboard shortcuts

## Dev Notes

### Previous Story Insights
[Source: Story 2.3 completion context]
- Advanced export options with Word and PDF are complete
- Professional formatting is working
- Export metadata and file naming are implemented
- High-quality export generation is functional

### Data Models
[Source: architecture.md#data-models]

**Question Edit Model:**
```typescript
interface QuestionEdit {
  id: string;
  question_text: string;
  correct_answer: string;
  options: string[]; // For multiple choice
  difficulty: 'easy' | 'medium' | 'hard';
  order_index: number;
  is_modified: boolean;
  modified_at: Date;
}
```

**Edit Session Model:**
```typescript
interface EditSession {
  question_set_id: string;
  user_id: string;
  changes: QuestionEdit[];
  auto_save_enabled: boolean;
  last_saved: Date;
  session_id: string;
}
```

### API Specifications
[Source: architecture.md#api-specification]

**Question Editing Endpoints:**
- `GET /api/question-sets/{id}/questions` - Get questions for editing
- `PUT /api/questions/{id}` - Update individual question
- `POST /api/question-sets/{id}/reorder` - Reorder questions
- `DELETE /api/questions/{id}` - Delete question
- `POST /api/question-sets/{id}/save` - Save all changes
- `GET /api/question-sets/{id}/preview` - Get template preview

**Question Update Request:**
```typescript
interface QuestionUpdateRequest {
  question_text: string;
  correct_answer: string;
  options?: string[]; // For multiple choice
  difficulty: 'easy' | 'medium' | 'hard';
  order_index: number;
}
```

### Component Specifications
[Source: architecture.md#components]

**Question Preview Interface:**
- Display all questions in editable format
- Technology Stack: MUI DataGrid, Rich text editor
- Must support all question types and editing

**Question Editor Component:**
- Inline editing for question content
- Technology Stack: MUI TextField, MUI Select, Rich text editor
- Must provide intuitive editing experience

**Template Preview Component:**
- Show final export formatting
- Technology Stack: Markdown renderer, MUI Paper
- Must update in real-time with changes

### File Locations
[Source: architecture.md#unified-project-structure]

**Question Editing Service Files:**
```
apps/web/src/services/
├── questionEditingService.ts
├── questionReorderService.ts
├── autoSaveService.ts
└── templatePreviewService.ts
```

**Component Files:**
```
apps/web/src/components/features/questions/
├── QuestionPreviewInterface.tsx
├── QuestionEditor.tsx
├── QuestionReorder.tsx
├── TemplatePreview.tsx
└── EditControls.tsx
```

**Hook Files:**
```
apps/web/src/hooks/
├── useQuestionEditing.ts
├── useAutoSave.ts
└── useTemplatePreview.ts
```

### Testing Requirements
[Source: architecture.md#testing-strategy]

**Testing Standards:**
- Test file location: `apps/web/src/__tests__/` for unit tests
- Testing frameworks: Vitest + Testing Library for unit and integration tests
- Unit test coverage: Minimum 85% code coverage for new functionality

**Testing Requirements for this story:**
- Unit tests for question editing functionality
- Unit tests for reordering and deletion
- Unit tests for auto-save mechanism
- Integration tests for complete editing workflow
- Test template preview with various changes

### Technical Constraints
[Source: architecture.md#tech-stack]

**Editing Interface:**
- Rich text editor for question content
- Drag-and-drop for reordering
- Auto-save every 30 seconds
- Real-time template preview updates

**Environment Variables:**
```bash
AUTO_SAVE_INTERVAL=30000  # 30 seconds
MAX_QUESTIONS_PER_SET=200
TEMPLATE_PREVIEW_CACHE_TTL=300
```

**Performance Requirements:**
- Interface should be responsive with up to 200 questions
- Auto-save should complete within 2 seconds
- Template preview should update within 1 second
- Smooth drag-and-drop with visual feedback

**User Experience:**
- Intuitive editing controls
- Clear visual feedback for changes
- Undo/redo functionality
- Keyboard shortcuts for common actions

### Error Scenarios
[Source: prd-epic2-stories.md#story-24]

**Error Handling Requirements:**
- Question Loading Failure: "Unable to load questions. Please refresh the page and try again"
- Edit Save Failure: "Unable to save changes. Please check your connection and try again"
- Invalid Edit Content: "Invalid content detected. Please check your edits and try again"
- Reorder Operation Failed: "Unable to reorder questions. Please try again or refresh the page"
- Question Deletion Error: "Unable to delete question. Please try again or contact support"
- Template Preview Error: "Template preview unavailable. Please try again or select a different template"
- Auto-save Conflict: "Changes conflict detected. Please refresh to see latest version"
- Interface Loading Error: "Preview interface failed to load. Please refresh the page"
- Data Synchronization Error: "Data sync error. Some changes may not be saved. Please refresh and try again"

## Testing

### Testing Standards
[Source: architecture.md#testing-strategy]

**Test File Location:**
- Unit tests: `apps/web/src/__tests__/`
- Integration tests: `apps/web/src/__tests__/integration/`
- E2E tests: `apps/web/e2e/`

**Testing Frameworks:**
- Unit/Integration: Vitest + Testing Library
- E2E: Playwright (for future stories)

**Test Coverage Requirements:**
- Minimum 85% code coverage for new functionality
- All editing functions must have unit tests
- All error scenarios must be tested

**Testing Patterns:**
- Test question editing with various question types
- Validate reordering and deletion functionality
- Test auto-save with network interruptions
- Mock API responses for consistent testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| [Current Date] | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
_To be populated by development agent_

### Debug Log References
_To be populated by development agent_

### Completion Notes List
_To be populated by development agent_

### File List
_To be populated by development agent_

## QA Results
_To be populated by QA agent_
